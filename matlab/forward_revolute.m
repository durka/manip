% in 2D and 3D
%   params{1} SE(n) is the center of rotation (WRT from-object center)
%   params{2} SE(n) is the offset from the center to the moving part at theta=0
%   state     R     is the angle around the circle
function [x, Dr, Dt] = forward_revolute(params, state)
    center = params{1};
    radius = params{2};
    theta = state;
    
    n = size(center,1)-1;
    x = radius * R(theta*eye(1,n*(n-1)/2)) * center;
    
    if nargout > 1
        [ct, cr] = extract_SE(center);
        [rt, rr] = extract_SE(radius);
        if length(ct) == 2
            thr = rr + theta;
            th = cr + thr;
            Dr = [ 0 0 -sin(th)     0 0 -sin(th)    -sin(th)
                   0 0  cos(th)     0 0  cos(th)     cos(th)
                   0 0 -cos(th)     0 0 -cos(th)    -cos(th)
                   0 0 -sin(th)     0 0 -sin(th)    -sin(th) ];
            Dt = [ cos(thr) -sin(thr) 0     1 0 -sin(thr)*ct(1)-cos(thr)*ct(2)      -sin(thr)*ct(1)-cos(thr)*ct(2)
                   sin(thr)  cos(thr) 0     0 1  cos(thr)*ct(1)-sin(thr)*ct(2)       cos(thr)*ct(1)-sin(thr)*ct(2) ];
        else
            Dr =   [ 0, 0, 0, (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) + (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))))  , cos(cr(1))*cos(cr(3))*sin(cr(2))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) + cos(cr(3))*sin(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - cos(cr(2))*cos(cr(3))*cos(rr(1))*sin(rr(2))  , (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) - (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) + cos(rr(1))*sin(cr(2))*sin(cr(3))*sin(rr(2)), 0, 0, 0, (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) + cos(cr(3))*sin(cr(2))*sin(rr(1))*sin(rr(2)), (cos(rr(1))*cos(rr(3))*sin(rr(2))*sin(theta) + cos(rr(1))*cos(theta)*sin(rr(2))*sin(rr(3)))*(cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1))) + (cos(rr(1))*cos(rr(3))*cos(theta)*sin(rr(2)) - cos(rr(1))*sin(rr(2))*sin(rr(3))*sin(theta))*(sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3))) - cos(cr(3))*cos(rr(1))*cos(rr(2))*sin(cr(2)), (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) + (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))))  , (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) + (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))))
                     0, 0, 0, - (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))), - cos(cr(1))*cos(cr(3))*sin(cr(2))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - cos(cr(3))*sin(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - cos(cr(2))*cos(cr(3))*sin(rr(1))*sin(rr(2)), (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) + sin(cr(2))*sin(cr(3))*sin(rr(1))*sin(rr(2)), 0, 0, 0, (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) - (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - cos(cr(3))*cos(rr(1))*sin(cr(2))*sin(rr(2)), (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(rr(3))*sin(rr(1))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(1))*sin(rr(2))*sin(rr(3))) + (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(rr(3))*cos(theta)*sin(rr(1))*sin(rr(2)) - sin(rr(1))*sin(rr(2))*sin(rr(3))*sin(theta)) - cos(cr(3))*cos(rr(2))*sin(cr(2))*sin(rr(1)), - (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))), - (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))))
                     0, 0, 0, (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2))) + (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3)))                                                                                                                                                      , cos(cr(2))*cos(cr(3))*cos(rr(2)) + cos(cr(1))*cos(cr(3))*sin(cr(2))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2))) + cos(cr(3))*sin(cr(1))*sin(cr(2))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3)))                                                                                                                                                                 , (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2))) - (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3))) - cos(rr(2))*sin(cr(2))*sin(cr(3))                                                                                                                                                               , 0, 0, 0, 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                    , (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(rr(2))*sin(rr(3))*sin(theta) - cos(rr(2))*cos(rr(3))*cos(theta)) - (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(rr(2))*cos(rr(3))*sin(theta) + cos(rr(2))*cos(theta)*sin(rr(3))) - cos(cr(3))*sin(cr(2))*sin(rr(2))                                                       , (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2))) + (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3)))                                                                                                                                                      , (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2))) + (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3)))
                     0, 0, 0, (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) + (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))))  , cos(cr(2))*cos(rr(1))*sin(cr(3))*sin(rr(2)) - sin(cr(1))*sin(cr(2))*sin(cr(3))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - cos(cr(1))*sin(cr(2))*sin(cr(3))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))))  , (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) + cos(cr(3))*cos(rr(1))*sin(cr(2))*sin(rr(2)), 0, 0, 0, (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - sin(cr(2))*sin(cr(3))*sin(rr(1))*sin(rr(2)), (cos(rr(1))*cos(rr(3))*sin(rr(2))*sin(theta) + cos(rr(1))*cos(theta)*sin(rr(2))*sin(rr(3)))*(cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3))) + (cos(rr(1))*cos(rr(3))*cos(theta)*sin(rr(2)) - cos(rr(1))*sin(rr(2))*sin(rr(3))*sin(theta))*(cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3))) + cos(rr(1))*cos(rr(2))*sin(cr(2))*sin(cr(3)), (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) + (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))))  , (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) + (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))))
                     0, 0, 0, - (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))), cos(cr(1))*sin(cr(2))*sin(cr(3))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) + sin(cr(1))*sin(cr(2))*sin(cr(3))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) + cos(cr(2))*sin(cr(3))*sin(rr(1))*sin(rr(2))  , (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) + cos(cr(3))*sin(cr(2))*sin(rr(1))*sin(rr(2)), 0, 0, 0, (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) - (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) + cos(rr(1))*sin(cr(2))*sin(cr(3))*sin(rr(2)), (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(rr(3))*cos(theta)*sin(rr(1))*sin(rr(2)) - sin(rr(1))*sin(rr(2))*sin(rr(3))*sin(theta)) + (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(rr(3))*sin(rr(1))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(1))*sin(rr(2))*sin(rr(3))) + cos(rr(2))*sin(cr(2))*sin(cr(3))*sin(rr(1)), - (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))), - (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))))
                     0, 0, 0, (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3))) + (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2)))                                                                                                                                                      , - cos(cr(2))*cos(rr(2))*sin(cr(3)) - cos(cr(1))*sin(cr(2))*sin(cr(3))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2))) - sin(cr(1))*sin(cr(2))*sin(cr(3))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3)))                                                                                                                                                               , (cos(cr(1))*sin(cr(3)) + cos(cr(2))*cos(cr(3))*sin(cr(1)))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3))) - (sin(cr(1))*sin(cr(3)) - cos(cr(1))*cos(cr(2))*cos(cr(3)))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2))) - cos(cr(3))*cos(rr(2))*sin(cr(2))                                                                                                                                                               , 0, 0, 0, 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                    , (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(rr(2))*sin(rr(3))*sin(theta) - cos(rr(2))*cos(rr(3))*cos(theta)) - (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(cos(rr(2))*cos(rr(3))*sin(theta) + cos(rr(2))*cos(theta)*sin(rr(3))) + sin(cr(2))*sin(cr(3))*sin(rr(2))                                                       , (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3))) + (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2)))                                                                                                                                                      , (cos(cr(3))*sin(cr(1)) + cos(cr(1))*cos(cr(2))*sin(cr(3)))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3))) + (cos(cr(1))*cos(cr(3)) - cos(cr(2))*sin(cr(1))*sin(cr(3)))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2)))
                     0, 0, 0, cos(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - sin(cr(1))*sin(cr(2))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))))                                                                            , cos(cr(1))*cos(cr(2))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) + cos(cr(2))*sin(cr(1))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) + cos(rr(1))*sin(cr(2))*sin(rr(2))                                   , 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                    , 0, 0, 0, cos(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) + sin(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) + cos(cr(2))*sin(rr(1))*sin(rr(2))                                                                                     , cos(cr(1))*sin(cr(2))*(cos(rr(1))*cos(rr(3))*cos(theta)*sin(rr(2)) - cos(rr(1))*sin(rr(2))*sin(rr(3))*sin(theta)) - sin(cr(1))*sin(cr(2))*(cos(rr(1))*cos(rr(3))*sin(rr(2))*sin(theta) + cos(rr(1))*cos(theta)*sin(rr(2))*sin(rr(3))) - cos(cr(2))*cos(rr(1))*cos(rr(2))                                                                                     , cos(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - sin(cr(1))*sin(cr(2))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))))                                                                            , cos(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - sin(cr(1))*sin(cr(2))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))))
                     0, 0, 0, sin(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - cos(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))))                                                                            , sin(cr(2))*sin(rr(1))*sin(rr(2)) - cos(cr(1))*cos(cr(2))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - cos(cr(2))*sin(cr(1))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))))                                   , 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                    , 0, 0, 0, cos(cr(1))*sin(cr(2))*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) + sin(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - cos(cr(2))*cos(rr(1))*sin(rr(2))                                                                                     , cos(cr(1))*sin(cr(2))*(cos(rr(3))*cos(theta)*sin(rr(1))*sin(rr(2)) - sin(rr(1))*sin(rr(2))*sin(rr(3))*sin(theta)) - sin(cr(1))*sin(cr(2))*(cos(rr(3))*sin(rr(1))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(1))*sin(rr(2))*sin(rr(3))) - cos(cr(2))*cos(rr(2))*sin(rr(1))                                                                                     , sin(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - cos(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))))                                                                            , sin(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))) - cos(cr(1))*sin(cr(2))*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))))
                     0, 0, 0, -(sin(cr(1) + rr(3) + theta)*(cos(cr(2) + rr(2)) - cos(cr(2) - rr(2))))/2                                                                                                                                                                                                                                                                                                                                                , cos(cr(1))*cos(cr(2))*(sin(rr(2))*sin(rr(3))*sin(theta) - cos(rr(3))*cos(theta)*sin(rr(2))) - cos(rr(2))*sin(cr(2)) + cos(cr(2))*sin(cr(1))*(cos(rr(3))*sin(rr(2))*sin(theta) + cos(theta)*sin(rr(2))*sin(rr(3)))                                                                                                                                                                                                  , 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                    , 0, 0, 0, 0                                                                                                                                                                                                                                                                                                                                                                                                                                                                    , cos(cr(1))*sin(cr(2))*(cos(rr(2))*sin(rr(3))*sin(theta) - cos(rr(2))*cos(rr(3))*cos(theta)) - cos(cr(2))*sin(rr(2)) + sin(cr(1))*sin(cr(2))*(cos(rr(2))*cos(rr(3))*sin(theta) + cos(rr(2))*cos(theta)*sin(rr(3)))                                                                                                                                            , -(sin(cr(1) + rr(3) + theta)*(cos(cr(2) + rr(2)) - cos(cr(2) - rr(2))))/2                                                                                                                                                                                                                                                                                                                                                , -(sin(cr(1) + rr(3) + theta)*(cos(cr(2) + rr(2)) - cos(cr(2) - rr(2))))/2                                                                                                                                                                                                                                                                                                                                                     ];
            Dt =   [ - cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) - sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))), sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) - cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))), -cos(rr(1))*sin(rr(2)), 0, 0, 0, 1, 0, 0, ct(3)*sin(rr(1))*sin(rr(2)) - ct(2)*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - ct(1)*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))))  , cos(rr(1))*(ct(2)*cos(rr(3))*sin(rr(2))*sin(theta) - ct(1)*cos(rr(3))*cos(theta)*sin(rr(2)) - ct(3)*cos(rr(2)) + ct(2)*cos(theta)*sin(rr(2))*sin(rr(3)) + ct(1)*sin(rr(2))*sin(rr(3))*sin(theta)), ct(2)*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) - ct(1)*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))), ct(2)*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) - ct(1)*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))))
                       cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))  , cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))), -sin(rr(1))*sin(rr(2)), 0, 0, 0, 0, 1, 0, - ct(1)*(cos(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3))) + sin(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3)))) - ct(2)*(cos(theta)*(cos(rr(3))*sin(rr(1)) + cos(rr(1))*cos(rr(2))*sin(rr(3))) - sin(theta)*(sin(rr(1))*sin(rr(3)) - cos(rr(1))*cos(rr(2))*cos(rr(3)))) - ct(3)*cos(rr(1))*sin(rr(2)), sin(rr(1))*(ct(2)*cos(rr(3))*sin(rr(2))*sin(theta) - ct(1)*cos(rr(3))*cos(theta)*sin(rr(2)) - ct(3)*cos(rr(2)) + ct(2)*cos(theta)*sin(rr(2))*sin(rr(3)) + ct(1)*sin(rr(2))*sin(rr(3))*sin(theta)), ct(1)*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - ct(2)*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3)))), ct(1)*(cos(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))) - sin(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1)))) - ct(2)*(cos(theta)*(cos(rr(1))*sin(rr(3)) + cos(rr(2))*cos(rr(3))*sin(rr(1))) + sin(theta)*(cos(rr(1))*cos(rr(3)) - cos(rr(2))*sin(rr(1))*sin(rr(3))))
                       cos(rr(3) + theta)*sin(rr(2))                                                                                                                  , -sin(rr(3) + theta)*sin(rr(2))                                                                                                               , cos(rr(2))            , 0, 0, 0, 0, 0, 1, 0                                                                                                                                                                                                                                                                                                                                            , - ct(1)*(cos(rr(2))*sin(rr(3))*sin(theta) - cos(rr(2))*cos(rr(3))*cos(theta)) - ct(2)*(cos(rr(2))*cos(rr(3))*sin(theta) + cos(rr(2))*cos(theta)*sin(rr(3))) - ct(3)*sin(rr(2))                   , -sin(rr(2))*(ct(2)*cos(rr(3) + theta) + ct(1)*sin(rr(3) + theta))                                                                                                                                                                                                                                            , -sin(rr(2))*(ct(2)*cos(rr(3) + theta) + ct(1)*sin(rr(3) + theta))                                                                                                                                                                                                                                              ];
        end
    end
end
